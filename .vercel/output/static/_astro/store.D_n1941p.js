import{a as s}from"./auth.DG5h8cRj.js";let l=[],r=0;const c=4,m=a=>{let e=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},lc:0,listen(n){return t.lc=e.push(n),()=>{for(let o=r+c;o<l.length;)l[o]===n?l.splice(o,c):o+=c;let i=e.indexOf(n);~i&&(e.splice(i,1),--t.lc||t.off())}},notify(n,i){let o=!l.length;for(let f of e)l.push(f,t.value,n,i);if(o){for(r=0;r<l.length;r+=c)l[r](l[r+1],l[r+2],l[r+3]);l.length=0}},off(){},set(n){let i=t.value;i!==n&&(t.value=n,t.notify(i))},subscribe(n){let i=t.listen(n);return n(t.value),i},value:a};return t},g=(a={})=>{let e=m(a);return e.setKey=function(t,n){let i=e.value;typeof n>"u"&&t in e.value?(e.value={...e.value},delete e.value[t],e.notify(i,t)):e.value[t]!==n&&(e.value={...e.value,[t]:n},e.notify(i,t))},e},u=g({user:null,isAuthenticated:!1,isPartner:!1,teams:[],currentTeam:null,ownedTeam:null,loading:!0});async function d(){console.log("Auth init started (Global)");try{const a=await s.getCurrentUser();if(a){const e=await s.getTeams(),t=await s.getOwnedTeam(a.$id),n=localStorage.getItem("activeTeamId");let i=null;n&&(i=e.find(o=>o.$id===n)||null),u.set({user:a,isAuthenticated:!0,isPartner:a.labels.includes("partner"),teams:e,ownedTeam:t,currentTeam:i,loading:!1}),i&&window.dispatchEvent(new CustomEvent("team-changed",{detail:{teamId:i.$id}}))}else u.setKey("loading",!1)}catch(a){console.error("Auth init error:",a),u.setKey("loading",!1)}}async function T(a,e,t){await s.register(a,e,t),await d()}async function h(a,e){await s.login(a,e),await d()}async function y(){await s.logout(),u.set({user:null,isAuthenticated:!1,isPartner:!1,teams:[],currentTeam:null,ownedTeam:null,loading:!1}),localStorage.removeItem("activeTeamId"),window.location.href="/login"}async function w(a){u.setKey("currentTeam",a),a?localStorage.setItem("activeTeamId",a.$id):localStorage.removeItem("activeTeamId"),window.dispatchEvent(new CustomEvent("team-changed",{detail:{teamId:a?a.$id:null}}))}async function I(a){const e=await s.createTeam(a),t=await s.getTeams();u.setKey("teams",t),u.setKey("ownedTeam",e),w(e)}async function p(a,e){await s.inviteMember(a,e)}export{y as a,d as b,I as c,u as d,p as i,h as l,T as r,w as s};
