import{s as a,I as s,d as I,P as g,R as f}from"./appwrite.Cu45kNVr.js";const w="resale_db",m="items",o="item_images";async function P(r,e,i={},n){try{let l=null;if(e&&o)try{l=(await a.createFile(o,s.unique(),e)).$id}catch(c){console.warn("Image upload failed (Check Bucket ID permissions):",c)}let u=null;if(i.receiptFile&&o)try{u=(await a.createFile(o,s.unique(),i.receiptFile)).$id}catch(c){console.warn("Receipt upload failed:",c)}let t=[];if(i.galleryFiles&&i.galleryFiles.length>0&&o)try{t=(await Promise.all(i.galleryFiles.map(y=>a.createFile(o,s.unique(),y)))).map(y=>y.$id)}catch(c){console.warn("Gallery upload failed:",c)}const p={title:r.title,identity:typeof r.identity=="object"?JSON.stringify(r.identity):r.identity,priceMint:r.price_breakdown?.mint?String(r.price_breakdown.mint):null,priceFair:r.price_breakdown?.fair?String(r.price_breakdown.fair):null,pricePoor:r.price_breakdown?.poor?String(r.price_breakdown.poor):null,keywords:r.keywords,conditionNotes:r.condition_notes,imageId:l,galleryImageIds:t,purchasePrice:i.paidPrice||"0",purchaseLocation:i.purchaseLocation||"",maxBuyPrice:i.maxBuyPrice||"0",binLocation:i.binLocation||"",resalePrice:i.resalePrice||"0",receiptImageId:u,createdAt:new Date().toISOString(),status:i.status||"draft",teamId:n||null},d=n?[g.read(f.team(n)),g.update(f.team(n)),g.delete(f.team(n))]:[];return await I.createDocument(w,m,s.unique(),p,d)}catch(l){throw console.error("Appwrite Save Error:",l),l}}async function b(r){try{return await I.deleteDocument(w,m,r),!0}catch(e){throw console.error("Error deleting item:",e),e}}async function L(r,e){try{const i={};if(e.status&&(i.status=e.status),e.receiptFile&&o){const t=await a.createFile(o,s.unique(),e.receiptFile);i.receiptImageId=t.$id}if(e.imageFile&&o){const t=await a.createFile(o,s.unique(),e.imageFile);i.imageId=t.$id}let n=e.existingGalleryIds||[],l=!1;if(e.galleryFiles&&e.galleryFiles.length>0&&o){const p=(await Promise.all(e.galleryFiles.map(d=>a.createFile(o,s.unique(),d)))).map(d=>d.$id);n=[...n,...p],l=!0}return(e.existingGalleryIds||l)&&(i.galleryImageIds=n),e.paidPrice&&(i.purchasePrice=e.paidPrice),e.purchaseLocation&&(i.purchaseLocation=e.purchaseLocation),e.title&&(i.title=e.title),e.binLocation&&(i.binLocation=e.binLocation),e.resalePrice&&(i.resalePrice=e.resalePrice),await I.updateDocument(w,m,r,i)}catch(i){throw console.error("Error updating item:",i),i}}export{b as d,P as s,L as u};
